
<ace-modal #paceModalContainerDialog (outputEventFeatureRuleUpdate)="ruleUpdated($event)"
                                     (outputEventconfigurationSchemaUpdate)="schemaUpdated($event)"
                                    (outputEventdefaultConfigUpdate)="defaultConfigurationUpdated($event)"
                                    (outputEventoutputConfigUpdate)="outputConfigurationUpdated($event)">
</ace-modal>
<!--    <simple-notifications [options]="options" (onCreate)="onCreate($event)" (onDestroy)="onDestroy($event)"></simple-notifications>-->
<div id="tloader" [hidden]="!loading">
    <div></div>
</div>
<nb-card [class.center-fixed-size-modal]="!inlineMode" [style.width]="modalWidth" [style.height]="modalHeight" [class.edit-inline]="inlineMode" *ngIf="visible">
    <nb-card-header *ngIf="variant != null">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="close()">
            <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title">
                <span>
                     <span *ngIf="isDirty()">*</span>{{title}} - {{variant.name}}
                </span>
        </h4>
    </nb-card-header>
    <nb-card-body>
        <div>
            <div [class.editModalLeftPane]="!inlineMode" [class.flexMiddleContainer]="inlineMode">
                <span>
                    <button nbButton style="text-transform: capitalize; border-style: none;" fullWidth class="tabButton" outline status="primary" *ngIf="generalTabActive" (click)="selectTab('General')">General</button>
                    <button nbButton style="text-transform: capitalize; border-style: none;" fullWidth class="tabButton" outline status="basic" *ngIf="!generalTabActive" (click)="selectTab('General')">General</button>
                </span>
                <span *ngIf="variant != null">
                        <button nbButton style="text-transform: capitalize; border-style: none;" fullWidth class="tabButton" outline status="primary" *ngIf="ruleTabActive" (click)="selectTab('Rule')">{{getString('edit_variant_rule_tab_heading')}}</button>
                        <button nbButton style="text-transform: capitalize; border-style: none;" fullWidth class="tabButton" outline status="basic" *ngIf="!ruleTabActive" (click)="selectTab('Rule')">{{getString('edit_variant_rule_tab_heading')}}</button>
                </span>
                <span *ngIf="variant != null">
                        <button nbButton style="text-transform: capitalize; border-style: none;" fullWidth class="tabButton" outline status="primary" *ngIf="descriptionTabActive" (click)="selectTab('Description')">{{getString('edit_variant_description_tab_heading')}}</button>
                        <button nbButton style="text-transform: capitalize; border-style: none;" fullWidth class="tabButton" outline status="basic" *ngIf="!descriptionTabActive" (click)="selectTab('Description')">{{getString('edit_variant_description_tab_heading')}}</button>
                </span>
            </div>
            <div *ngIf="isOpen" [class.editModalRightPane]="!inlineMode">
                <div #general *ngIf="generalTabActive">
                            <span>
                                <div class="tabContentBackgroud tab-div-container">
                                    <div class="box">
                                        <div class="row1">
                                            <div class="row no-margin" *ngIf="variant != null">
                                                <label for="input01" class="control-label">Name</label>
                                                <airlock-tooltip class="endFlexContainer" [content]="getString('edit_variant_name')"
                                                                 [title]="getString('edit_variant_name_title')"></airlock-tooltip>
                                                <input type="text" disabled id="input01" placeholder="" [(ngModel)]="variant.name"
                                                       class="form-control blackText" tabindex="1">
                                            </div>
                                            <div class="row no-margin" *ngIf="variant != null">
                                                <label for="input101" class="control-label">Display Name</label>
                                                <airlock-tooltip class="endFlexContainer"
                                                                 [content]="getString('edit_variant_displayname')"
                                                                 [title]="getString('edit_variant_displayname_title')"></airlock-tooltip>
                                                <input type="text" [disabled]="isOnlyDisplayMode" id="input101" placeholder=""
                                                       [(ngModel)]="variant.displayName" class="form-control blackText"
                                                       tabindex="2">
                                            </div>
                                            <div class="row no-margin" *ngIf="variant != null">
                                                <label for="input01" class="control-label">Branch</label>
                                                <airlock-tooltip class="endFlexContainer" [content]="getString('edit_variant_name')"
                                                                 [title]="getString('edit_variant_name_title')"></airlock-tooltip>
                                                <br>
                                                <nb-select *ngIf="!loading" class="full-no-padding" [(selected)]="variant.branchName" [placeholder]="">
                                                    <nb-option hero *ngFor="let branch of availableBranchesForSelect"
                                                               value="{{branch.id}}"> {{ branch.text }} </nb-option>
                                                </nb-select>
                                            </div>
                                            <div class="row no-margin" *ngIf="variant != null">
                                                <div class="col-md-6 no-padding-left">
                                                    <div class="no-margin " *ngIf="variant != null">
                                                        <label for="input07" class="control-label">Stage</label>
                                                        <airlock-tooltip class="endFlexContainer"
                                                                         [content]="getString('edit_variant_stage')"
                                                                         [title]="getString('edit_variant_stage_title')"></airlock-tooltip>
                                                        <input type="text" id="input07" placeholder="" [(ngModel)]="variant.stage"
                                                               class="form-control blackText" disabled>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 no-padding-right">
                                                    <div class="no-margin " *ngIf="variant != null">
                                                        <label for="input87" class="control-label">Rollout Percentage</label>
                                                        <airlock-tooltip class="endFlexContainer"
                                                                         [content]="getString('edit_variant_rollout')"
                                                                         [title]="getString('edit_variant_rollout_title')"></airlock-tooltip>
                                                        <div class="input-group rollout">
                                                            <input id="input87" [disabled]="isOnlyDisplayMode"
                                                                   aria-label="Rollout percentage"
                                                                   step="0.0001"
                                                                   class="form-control with-success-addon numberInput" type="number"
                                                                   min="0" max="100" [(ngModel)]="variant.rolloutPercentage"
                                                                   tabindex="4" style="width: 100px;height: 33px;">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row no-margin ">
                                                <label class="control-label">User Groups</label>
                                                <airlock-tooltip class="endFlexContainer"
                                                                 [content]="getString('edit_variant_groups')"
                                                                 [title]="getString('edit_variant_groups_title')"></airlock-tooltip>
                                                <br>
                                                <user-groups-input id="select05" [disabled]="isOnlyDisplayMode" [(internalUserGroups)]="variant.internalUserGroups" [possibleGroupsList]="possibleGroupsList"></user-groups-input>
                                            </div>
                                            <div class="row no-margin">
                                                <div class="col-md-6 no-padding-left">
                                                    <div class="no-margin" *ngIf="variant != null">
                                                        <label for="input80" class="control-label">Creation Date</label>
                                                        <airlock-tooltip class="endFlexContainer"
                                                                         [content]="getString('edit_varianr_creation_date')"
                                                                         [title]="getString('edit_variant_creation_date_title')"></airlock-tooltip>
                                                        <input type="text" id="input80" disabled placeholder=""
                                                               [value]="creationDate | date:'medium'"
                                                               class="form-control blackText">
                                                    </div>
                                                </div>
                                                <div class="col-md-6 no-padding-right">
                                                    <div class="no-margin " *ngIf="variant != null">
                                                        <label for="input82" class="control-label">Last Modified</label>
                                                        <airlock-tooltip class="endFlexContainer"
                                                                         [content]="getString('edit_variant_last_modified')"
                                                                         [title]="getString('edit_variant_last_modified_title')"></airlock-tooltip>
                                                        <input type="text" id="input82" disabled placeholder=""
                                                               [value]="lastModificationDate | date:'medium'"
                                                               class="form-control blackText">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row no-margin">
                                                <div class="col-md-8 no-padding-left">
                                                    <div class="no-margin " *ngIf="variant != null">
                                                        <label for="input08" class="control-label">Creator</label>
                                                        <airlock-tooltip class="endFlexContainer"
                                                                         [content]="getString('edit_variant_creator')"
                                                                         [title]="getString('edit_variant_creator_title')"></airlock-tooltip>
                                                        <input type="text" id="input08" disabled placeholder=""
                                                               [(ngModel)]="variant.creator" class="form-control blackText">
                                                    </div>
                                                </div>
                                                <div class="col-md-4 no-padding-right">
                                                    <div class="no-margin " *ngIf="variant != null">
                                                        <table style="width: 100%;">
                                                            <tr>
                                                                <td class="align-right"><label class="control-label">Enabled</label>
                                                                </td>
                                                                <airlock-tooltip class="endFlexContainer"
                                                                                 [content]="getString('edit_variant_enabled')"
                                                                                 [title]="getString('edit_variant_enabled_title')"></airlock-tooltip>
                                                            </tr>
                                                            <tr>
                                                                <td class="align-right">
                                                                    <nb-toggle [disabled]="isOnlyDisplayMode" [(checked)]="variant.enabled"
                                                                               tabindex="8"></nb-toggle>
                                                                </td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </span>
                </div>
                <div #ruleTab *ngIf="ruleTabActive">
                            <span>
                                <div class="tabContentBackgroud tab-div-container">
                                    <div class="box">
                                        <div class="row1">
                                                    <div class="no-margin  tab-div-container">
                                                        <span class="flexcontainer">
                                                            <h5 class="modal-title">
                                                                {{getString('edit_variant_rule_tab_details')}}
                                                                <br>
                                                                <button class="modalLink modalLinkButton"
                                                                        (click)="showRuleHelp()">{{getString('edit_variant_rule_tab_learn_more')}}</button>
                                                            </h5>
                                                        </span>

                                                    <div></div>
                                                    <span>
                                                            <button class="btn btn-expand btn-expand-rule btn-icon" type="button" [class.btn-expand-down-deeplink]="!inlineMode" (click)="openAceEditorRuleExpand()">
                                                            <i class="ion-arrow-expand"></i>
                                                        </button>
                                                        <div *ngIf="!loading" #mytesteditor ace-editor id="input56" (onTextChanged)="ruleUpdated($event)"
                                                             [markdown]="variant.rule.ruleString" [readonly]="isOnlyDisplayMode"
                                                             [sample]="ruleInputSchemaSample" [utilitiesinfo]="ruleUtilitiesInfo"
                                                             [mode]="'javascript'"
                                                             [heightSize]="aceEditorRuleHeight">
                                                        </div>
                                                        </span>
                                                </div>
                                        </div>
                                    </div>
                                </div>
                            </span>
                </div>
                <div #descriptionTab *ngIf="descriptionTabActive">
                        <span>
                            <div class="tabContentBackgroud tab-div-container">
                                <div class="box">
                                    <div class="row1">
                                        <div class="no-margin " *ngIf="variant != null">
                                            <label for="input55" class="control-label">Description</label>
                                            <airlock-tooltip class="endFlexContainer" [content]="getString('edit_variant_description')"
                                                             [title]="getString('edit_variant_description_title')"></airlock-tooltip>
                                            <textarea id="input55" [disabled]="isOnlyDisplayMode" placeholder=""
                                                      [(ngModel)]="variant.description" value="FEATURE"
                                                      class="form-control description-text blackText" style="height: 100px; resize:none"
                                                      tabindex="8"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </span>
                </div>
            </div>
        </div>
    </nb-card-body>
    <nb-card-footer *ngIf="variant != null">
        <button type="button" class="btn btn-primary align-button-left" *ngIf="inlineMode" data-dismiss="modal" (click)="openOnNewTab()">
            <i class="fa ion-compose"></i>Open in New Tab</button>
        <button type="button" class="btn btn-primary" (click)="save()" [disabled]="isOnlyDisplayMode">Save</button>
        <button type="button" class="btn btn-default" data-dismiss="modal" (click)="close()">Cancel</button>
    </nb-card-footer>
</nb-card>
